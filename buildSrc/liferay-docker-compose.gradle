
def currentProperties = loadLocalPropertiesIfExists()
def currentProfiles = currentProperties.getProperty('dc.profiles')?.split(',') ?: [""]

def loadLocalPropertiesIfExists() {
  
    def propertiesFileLocal = file('local.properties') 
    def myProperties = new Properties()

    if (propertiesFileLocal.exists()) {
        myProperties.load(propertiesFileLocal.newDataInputStream())
    }

    return myProperties
}

subprojects { 

	def containsModuleFiles = false

	def files = fileTree(projectDir).matching{ exclude { details -> details.directory } }.files
	files.each { file -> 
		if(file.name.contains("package.json") || file.name.contains("client-extension.yaml") || file.name.contains("build.gradle") ) { 
			containsModuleFiles = true
		} 
    }

	if(containsModuleFiles){
		task dcDeploy(dependsOn: 'deploy'){
			doLast() {
				if(file("client-extension.yaml").exists()) { 
					println "${project.name}"

					fileTree(dir: "${project.projectDir}/dist").visit { FileVisitDetails details ->
						project.exec {
							commandLine 'docker', "compose", "-f", "${project.rootDir}/docker-compose.yaml", 'cp', details.file.path, "liferay:/opt/liferay/deploy/"
						}
					}
				} else {
					fileTree(dir: "${project.projectDir}/build/libs").visit { FileVisitDetails details ->
						project.exec {
							commandLine 'docker', "compose", "-f", "${project.rootDir}/docker-compose.yaml", 'cp', details.file.path, "liferay:/opt/liferay/deploy/"
						}
					}
				}
			}
		}
	}
}